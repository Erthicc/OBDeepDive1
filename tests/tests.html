<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Game Unit Tests (Browser)</title>
    <style>body{font-family:Arial;padding:18px;background:#071026;color:#fff}</style>
  </head>
  <body>
    <h1>Simple Game Tests</h1>
    <div id="output"></div>
    <script type="module">
      import { Game } from '../src/game.js';
      import questions from '../data/questions.json' assert { type: 'json' };

      function assert(name, cond){
        const out = document.getElementById('output');
        const el = document.createElement('div');
        el.textContent = (cond ? 'PASS: ' : 'FAIL: ') + name;
        el.style.color = cond ? '#7ee787' : '#ff8b8b';
        out.appendChild(el);
      }

      // Create minimal questions for money calc test
      const q = questions.slice(0,6);
      const game = new Game({questions: q});
      game.reset();

      // Test money calc year 1 and 2
      const m1 = game.yearlyIncrement(1); // should be 1_000_000_000 * 1.07
      const m2 = game.yearlyIncrement(2);
      assert('Yearly increment > 1B', m1 > 1000000000);
      assert('Yearly increment year2 > year1', m2 > m1);

      // Simulate answering two correct in year1
      // Ensure game.currentQuestion exists
      let res = game.answer(q[0].correctIndex);
      res = game.answer(q[1].correctIndex);
      assert('Both correct yields money increase', game.state.money === m1);

      // Simulate one right one wrong in year2: should earn 0 and reduce health by 50
      res = game.answer(q[2].correctIndex);
      res = game.answer((q[3].correctIndex + 1) % q[3].options.length); // wrong
      assert('One wrong -> no money', game.state.money === m1);
      assert('Health reduced by 50', game.state.health === 50 || game.state.health === 60 || game.state.health < 100);

      // Simulate two wrongs -> bankrupt
      game.state.health = 100;
      res = game.answer((q[4].correctIndex + 1) % q[4].options.length); // wrong
      res = game.answer((q[5].correctIndex + 1) % q[5].options.length); // wrong
      assert('Two wrongs cause bankruptcy (isOver)', game.state.isOver === true || game.state.health === 0);

      console.log('Tests complete', game.state);
    </script>
  </body>
</html>
